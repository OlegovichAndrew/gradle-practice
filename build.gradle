/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.4.2/samples
 */

def clean(){
   exec {
        executable "sh"
        args "-c", "ls"
    }
}

def dockerBuild() {
    exec {
        commandLine 'sh', '-c', 'sudo docker build -t gradledockertest:latest ./folder4/AWS-Task2/AWS_Download_S3'
    }
}

// def gitClone() {
//     exec {
//         commandLine 'sh', '-c', 'git clone "${url}" "${folder}" 2>/dev/null && [ -d "${folder}" ]'
//     }
// }


def dockerRun() {
    exec {
        commandLine 'sh', '-c', 'sudo docker run --name gradledocker gradledockertest:latest'
    }
}

def folder = "AWS_Task2"

task buildWith {

    exec {
        workingDir '.'
        commandLine 'sh', '-c', 'mkdir -p folder4'
   }

    exec {
        workingDir './folder4'
        commandLine 'sh', '-c', 'git clone https://github.com/OlegovichAndrew/AWS-Task2.git'
    }
//     if ! gitClone() ; then
//         echo "Clone failed because the folder ${folder} exists"
//     fi

    dockerBuild()
    dockerRun()
    doLast {
        clean()
    }
}